---
layout: post
title: "IRC Responder"
author: NodeKC
tags:
---

# IRC Responder

The true power of Node.js is in the way it handles asynchronous I/O, especially network I/O. Let's use the `node-irc` npm module to interact with an IRC server. When you're done, you'll have an IRC bot that will respond to messages coming into a room that contain specific text.

## Getting started

Let's start this lab the same way we did the last one. Create a new empty directory called `irc-lab`. Inside the `irc-lab` directory run `npm init` and `npm install --save irc` to install and save the irc module to your `package.json`.

Create a new file named `index.js` and `require()` the irc module to get started.

{% highlight javascript %}
var irc = require('irc');
{% endhighlight %}

## Connect to an IRC Server

To connect to an IRC server, execute `new irc.Client()` ([api doc](https://node-irc.readthedocs.org/en/latest/API.html)) constructor with the desired configuration.

*NOTE:* Be sure to use `floodProtection: true` for this lab, as we don't want to get banned from the IRC server.
*NOTE:* Be sure to set the `username` variable to something that will be unique to your bot.

{% highlight javascript %}
var irc = require('irc');

var username = {user};
var server = "chat.freenode.net"
var channel = "#nodelabs-irclab";

var client = new irc.Client(server, username, {
   channels: [ channel ],
   floodProtection: true,
   debug: true
});
{% endhighlight %}

The program will now join the room when executed. Run `node index.js` to see the client connect. If you enabled the `debug` option, your output should look something like this:

{% highlight bash %}
27 Oct 11:23:36 - SEND: NICK :nodelabsbot_atd
27 Oct 11:23:37 - SEND: USER nodebot 8 * :nodeJS IRC client
27 Oct 11:23:41 - Unhandled message: { prefix: 'niven.freenode.net',
  server: 'niven.freenode.net',
  command: 'rpl_luserunknown',
  rawCommand: '253',
  commandType: 'reply',
  args: [ 'nodelabsbot_atd', '6', 'unknown connection(s)' ] }
27 Oct 11:23:41 - MODE:nodelabsbot_atd sets mode: +i
27 Oct 11:23:42 - SEND: JOIN :#nodelabs-irclab
27 Oct 11:23:47 - MODE:#nodelabs-irclab sets mode: +ns
27 Oct 11:23:47 - SEND: MODE :#nodelabs-irclab
{% endhighlight %}

## Handling errors

The irc lient is a Node.js EventEmitter. You bind functions to emitted events by calling `on()`. The first event will bind to is the `error` event. When the client receives errors from the IRC network, it emits an `error` event. If you don't bind to the `error` event and one is emitted, it will cause a fatal stack trace, exiting the program.

The upshot of this is basically that if you bind an error handler to your client, errors will be sent there instead of crashing your program. For more information on EventEmitters, check out the the [Node JS EventEmitter documentation](http://nodejs.org/api/events.html#events_class_events_eventemitter).

{% highlight javascript %}
...

client.on('error', console.error);
{% endhighlight %}

This error handler will take any information passed to it and send it to STDERR. By subscribing to the `error` event, your application will no longer crash due to irc errors.

## Responding to messages
6. Now, to make it a little more interesting, we'll start listening and responding to messages in the chat room. For this lab, we'll use the following word list:

{% highlight bash %}
node              aardvark
bloody            smelly
bump              test
conversation      reticulating
crazy             event
{% endhighlight %}

Add an event listener for the `message` event, check for one of the words above, and, if present, respond with a sentence using a different one of the words above.

{% highlight javascript %}
var irc = require('irc');

var username = "";
var channel = "#nodelabs-irclab";

var client = new irc.Client("chat.freenode.net", username, {
   channels: [ channel ],
   floodProtection: true,
   debug: true
});

client.on("error", console.error);

client.on("message", function (user, channel, message) {
   if (user !== username && message.toLowerCase().indexOf("test") >= 0) {
      client.say(channel, "Get your bloody test messages off my lawn!");
   }
});
{% endhighlight %}

That's it! Fire up your bots and hop into the channel yourself to see the chatter!

## Looking for more?

Check out [HUBOT](http://hubot.github.com/), github's open-source chatbot running on Node.js written in [CoffeeScript](http://coffeescript.org/).

My personal favorite message responder: [pugme](https://github.com/github/hubot/blob/master/src/scripts/pugme.coffee).